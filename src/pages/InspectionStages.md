# Документация: Работа таблиц Inspection Data

Таблицы в блоке **Inspection Data** предназначены для фиксации результатов инспекции партии труб (Batch). В них отражается, как трубы проходят через последовательные стадии контроля, сколько списано на каждой стадии и какой остаток остался в конце. Главная цель этих таблиц — обеспечить прозрачный учет скрапов и автоматическую проверку баланса партии.

## Основная логика
Работа начинается с выбора **Client**, **Work Order** и батча, при этом в списке отображаются только батчи со статусом **Arrived**. После выбора батча в таблицу автоматически подставляется количество труб в этом батче. Это значение всегда фиксируется в колонке **Rattling_Qty**. Таким образом, **Rattling_Qty всегда равно количеству труб в батче**. Если количество труб в батче меняется, то формулы автоматически пересчитывают все строки таблицы заново.

Пользователь не вводит значения в колонках Qty. Эти значения считаются системой автоматически на основе введённых пользователем значений Scrap_Qty. В таблице есть две логики работы: слева всегда находится количество на входе каждой стадии (**Qty**), а справа — количество списанного на этой стадии (**Scrap_Qty**). Каждый шаг процесса связан формулой: **Scrap на шаге = вход на шаг – выход со следующего шага**.

## Структура таблицы
Стадии проходят по порядку:
1. Rattling
2. External
3. Hydro
4. MPI
5. Drift
6. EMI
7. Marking

Для каждой стадии в таблице есть две колонки:
- **Qty** (слева) — количество труб, оставшихся после предыдущего шага.
- **Scrap_Qty** (справа) — количество труб, списанных на этом шаге.

## Формулы расчета
Каждое следующее значение Qty вычисляется как разница между текущим Qty и Scrap_Qty. Формулы выглядят так:

- External_Qty = Rattling_Qty – Rattling_Scrap_Qty  
- Hydro_Qty    = External_Qty – External_Scrap_Qty  
- MPI_Qty      = Hydro_Qty – Jetting_Scrap_Qty  
- Drift_Qty    = MPI_Qty – MPI_Scrap_Qty  
- EMI_Qty      = Drift_Qty – Drift_Scrap_Qty  
- Marking_Qty  = EMI_Qty – EMI_Scrap_Qty  

Соответственно, каждая пара Qty и Scrap_Qty связана зависимостью:
- Rattling_Scrap_Qty = Rattling_Qty – External_Qty  
- External_Scrap_Qty = External_Qty – Hydro_Qty  
- Jetting_Scrap_Qty  = Hydro_Qty – MPI_Qty  
- MPI_Scrap_Qty      = MPI_Qty – Drift_Qty  
- Drift_Scrap_Qty    = Drift_Qty – EMI_Qty  
- EMI_Scrap_Qty      = EMI_Qty – Marking_Qty  

## Ограничения
1. **Scrap_Qty на шаге не может быть больше входного Qty.**
2. Все Qty всегда должны быть ≥ 0.
3. Значения Qty уменьшаются или остаются равными при переходе от шага к шагу, но никогда не увеличиваются.
4. Первая колонка (Rattling_Qty) всегда равна исходному количеству труб в батче и не может быть изменена пользователем.
5. Если исходное количество труб в батче меняется, вся таблица пересчитывается заново по формулам.

## Итоговый баланс
В конце таблицы должно выполняться равенство:
